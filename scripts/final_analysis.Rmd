---
title: "final_analysis"
author: "Nick Kathios"
date: '2022-12-02'
output: html_document
---
#loading in necessary packages
```{r}
library(tidyverse)
library(lmerTest)
library(lme4)
library(misty)
library(ggrepel)
```

#loading in data
```{r}
timeseries <- read.csv(file='../data/roitimeseries.csv')
unique(timeseries$SUBID)
timeseries$vocal= ifelse(timeseries$vocal=="y","Y", timeseries$vocal ) #recoding some values
timeseries$seconds<- (timeseries$TR - ((timeseries$order-1)*60))*0.475 # adding seconds to df
MIR <- read.csv(file='../data/audioExtraction.csv')

vocal_nonvocal <- read.csv(file='../data/vocal_nonvocal.csv')
vocal_nonvocal$vocal= ifelse(vocal_nonvocal$vocal=="y","Y", timeseries$vocal ) #recoding some values
vocal_nonvocal$liking= ifelse(vocal_nonvocal$liking=="0",NA, timeseries$liking ) #recoding some values
vocal_nonvocal$familiarity= ifelse(vocal_nonvocal$familiarity=="0",NA, timeseries$familiarity ) #recoding some values

timeseries_vocal <- subset(timeseries, timeseries$vocal=="Y")

#get scaled values - pMTGL
onset_value <- 
  timeseries %>%
  group_by(SUBID) %>%
  subset(seconds==0.475) %>%
  mutate(
    onset_value = pMTGL_univariatecluster #update ROIs here
  )

onset_value <- cbind(onset_value[3],onset_value[5],onset_value[28])

timeseries_scaled <- merge(timeseries, onset_value, by.x=c("SUBID","Stim"), by.y=c("SUBID", "Stim"))

timeseries_scaled <-
  timeseries_scaled %>%
  group_by(SUBID, Stim) %>%
  mutate(
    pMTGL_univariatecluster_scaled = ((pMTGL_univariatecluster - onset_value)/sd(pMTGL_univariatecluster)) #update ROIs here
  )
  
#get scaled values - pMTGR
onset_value <- 
  timeseries %>%
  group_by(SUBID) %>%
  subset(seconds==0.475) %>%
  mutate(
    onset_value = pMTGR_univariatecluster
  )

onset_value <- cbind(onset_value[3],onset_value[5],onset_value[28])

timeseries_scaled <- merge(timeseries_scaled, onset_value, by.x=c("SUBID","Stim"), by.y=c("SUBID", "Stim"))

timeseries_scaled <-
  timeseries_scaled %>%
  group_by(SUBID, Stim) %>%
  mutate(
    pMTGR_univariatecluster_scaled = ((pMTGR_univariatecluster - onset_value.y)/sd(pMTGR_univariatecluster)) 
  )

timeseries_scaled_peak <- timeseries_scaled %>%
  subset((seconds) >=6) %>%
  subset((seconds) <= 8)

#merge MIR features w/ MIR peaks
MIR_timeseries <- merge(timeseries_scaled_peak, MIR, by="Stim")
```


#visualizing ROI timeseries
```{r}
timeseries_other <- subset(timeseries_scaled, self_other=="other")

label<-
  expand.grid(
    vocal=c("Nonvocal", "Vocal"),
    seconds=12
  )
label$scaled <- ifelse(label$vocal=="Vocal", 1.25, 0.25)
timeseries_other$vocal <- ifelse(timeseries_other$vocal=="Y", "Vocal", "Nonvocal")

ggplot(timeseries_other, aes(x=round(seconds), y=pMTGR_univariatecluster_scaled)) + 
  annotate(xmin = 6, xmax = 8, ymin = -Inf, ymax = Inf, geom = 'rect', alpha = 0.4, fill="#F0E442") +
  geom_smooth(aes(color=vocal, fill=vocal))+
  theme_classic() +
  xlab("Time (s)") +
  ylab("Scaled ROI Activity") +
  ggtitle("Right pMTG Cluster") +#update labels
  theme(plot.title = element_text(face="bold", hjust = 0.5, size=18), axis.text=element_text(size=15), axis.title=element_text(size=15))+
  #geom_label_repel(aes(label = vocal, x=seconds, y=scaled, color=vocal),
   #                na.rm = TRUE,
              #     data=label,
     #              min.segment.length = Inf,
                 #  point.size = NA,
     #      #        family="Arial",
                #   size=8
                #   ) +
  scale_color_manual(values = c("#D55E00", "#56B4E9"))+
  scale_fill_manual(values = c("#D55E00", "#56B4E9"))+
  theme(legend.position = "none")+
  #ylim(0, 3)
  scale_y_continuous(breaks=c(0,0.5,1.0,1.5), limits=c(0, 1.8))

ggsave('pMTGRAllComparison.png', plot = last_plot(), scale=1, dpi=350)
```


#investigating differences in liking + familiarity
```{r}
vocal_nonvocal_other <- 
  vocal_nonvocal %>%
  subset(self_other=="other") %>%
  subset(MCI!="Y")

m1 <- lmer(scale(liking) ~ vocal + (vocal|participant_ID), data=vocal_nonvocal_other)
summary(m1)

m1 <- lmer(scale(familiarity) ~ vocal + (vocal|participant_ID), data=vocal_nonvocal_other)
summary(m1)
```

#older vs. younger comparisons
```{r}
test<-lmer(pMTGR_univariatecluster_scaled~older_younger*vocal.y + scale(RMS_energy) + scale(event_density) + (vocal.y + scale(RMS_energy) + scale(event_density)|SUBID), data=MIR_timeseries, control=lmerControl(optimizer="bobyqa"))
summary(test)

test<-lmer(pMTGL_univariatecluster_scaled~older_younger*vocal.y + scale(RMS_energy) + scale(event_density) + (vocal.y + scale(RMS_energy) + scale(event_density)|SUBID), data=MIR_timeseries,control=lmerControl(optimizer="bobyqa"))
summary(test)
```

#non-english vs english comparison
```{r}
timeseries_language <-
  MIR_timeseries %>%
  subset(Stim == 8 | Stim == 15 | Stim == 10 | Stim == 11 | Stim == 12 | Stim == 13 )

timeseries_language$language <- ifelse(timeseries_language$Stim == 8 | timeseries_language$Stim == 15, "Non-English", "English")

test<-lmer((pMTGL_univariatecluster_scaled) ~ (language) + (language|SUBID), data=timeseries_language) #random  intercepts + slopes
summary(test)

test<-lmer(((pMTGL_univariatecluster_scaled)) ~ (language) +  scale(RMS_energy) + scale(event_density) + (language + scale(RMS_energy) + scale(event_density)|SUBID), data=timeseries_language,control=lmerControl(optimizer="bobyqa")) #random  intercepts + slopes
summary(test)

test<-lmer((pMTGR_univariatecluster_scaled) ~ (language) + (language | SUBID), data=timeseries_language, control=lmerControl(optimizer="bobyqa")) #random  intercepts + slopes
summary(test)

test<-lmer((pMTGR_univariatecluster_scaled) ~ (language) +  scale(RMS_energy) + scale(event_density) + (language + scale(RMS_energy) + scale(event_density)|SUBID), data=timeseries_language, control=lmerControl(optimizer="bobyqa")) #random  intercepts + slopes
summary(test)
```

#plot
```{r}
timeseries_languageplot <-
  timeseries_scaled %>%
  subset(Stim == 8 | Stim == 15 | Stim == 10 | Stim == 11 | Stim == 12 | Stim == 13 )

timeseries_languageplot$language <- ifelse(timeseries_languageplot$Stim == 8 | timeseries_languageplot$Stim == 15, "Non-English", "English")

ggplot(timeseries_languageplot, aes(x=round(seconds), y=pMTGL_univariatecluster_scaled)) + 
  annotate(xmin = 6, xmax = 8, ymin = -Inf, ymax = Inf, geom = 'rect', alpha = 0.3, fill="#F0E442")+
  geom_smooth(aes(color=factor(language, labels = c("English Vocals", "Non-English Vocals")), fill=factor(language, labels = c("English Vocals", "Non-English Vocals"))), alpha=0.2) +
  theme_classic()+
  labs(x= "Time (s)", y="Scaled ROI Activity", color="stimulus type", fill="stimulus type")+
  ggtitle("Left pMTG Cluster") +
  theme(plot.title = element_text(face="bold", size = 18, hjust=0.5), axis.text=element_text(size=15), axis.title=element_text(size=15)) +
  scale_color_manual(values=c("#CC79A7", "#009E73")) +
  scale_fill_manual(values=c("#CC79A7", "#009E73"))

ggplot(timeseries_languageplot, aes(x=round(seconds), y=pMTGR_univariatecluster_scaled)) + 
  annotate(xmin = 6, xmax = 8, ymin = -Inf, ymax = Inf, geom = 'rect', alpha = 0.3, fill="#F0E442")+
  geom_smooth(aes(color=factor(language, labels = c("English Vocals", "Non-English Vocals")), fill=factor(language, labels = c("English Vocals", "Non-English Vocals"))), alpha=0.2) +
  theme_classic()+
  labs(x= "Time (s)", y="Scaled ROI Activity", color="stimulus type", fill="stimulus type")+
  ggtitle("Right pMTG Cluster") +
  theme(plot.title = element_text(face="bold", size = 18, hjust=0.5), axis.text=element_text(size=15), axis.title=element_text(size=15)) +
  scale_color_manual(values=c("#CC79A7", "#009E73")) +
  scale_fill_manual(values=c("#CC79A7", "#009E73"))
```

#non-english vs non-vocal comparison
```{r}
timeseries_language <-
  MIR_timeseries %>%
  subset(Stim == 8 | Stim == 15 | Stim == 9 | Stim == 7 | Stim == 14 | Stim == 17 )

timeseries_language$language <- ifelse(timeseries_language$Stim == 8 | timeseries_language$Stim == 15, "Non-English", "Non-Vocal")

test<-lmer((pMTGL_univariatecluster_scaled) ~ language  + ((RMS_energy) |SUBID), data=timeseries_language, control=lmerControl(optimizer="bobyqa")) #random intercepts
summary(test)

test<-lmer((pMTGL_univariatecluster_scaled) ~ language + scale(RMS_energy) + scale(event_density) + (language + scale(RMS_energy) |SUBID), data=timeseries_language, control=lmerControl(optimizer="bobyqa")) #random intercepts
summary(test)

test<-lmer((pMTGL_univariatecluster_scaled) ~ language + (1|SUBID), data=timeseries_language, control=lmerControl(optimizer="bobyqa")) #random intercepts
summary(test)

test<-lmer((pMTGL_univariatecluster_scaled) ~ language + scale(RMS_energy) + scale(event_density) + (language + scale(RMS_energy) + scale(event_density) |SUBID), data=timeseries_language, control=lmerControl(optimizer="bobyqa")) #random intercepts
summary(test)
```

#plot
```{r}
timeseries_languageplot <- timeseries_scaled %>%
 subset(Stim == 8 | Stim == 15 | Stim == 9 | Stim == 7 | Stim == 14 | Stim == 17 )

timeseries_languageplot$language <- ifelse(timeseries_languageplot$Stim == 8 | timeseries_languageplot$Stim == 15, "Non-English", "Non-Vocal")

ggplot(timeseries_languageplot, aes(x=round(seconds), y=pMTGR_univariatecluster_scaled)) + 
  annotate(xmin = 6, xmax = 8, ymin = -Inf, ymax = Inf, geom = 'rect', alpha = 0.3, fill="#F0E442")+
  geom_smooth(aes(color=factor(language, labels = c("Non-English Vocals", "Nonvocal")), fill=factor(language, labels = c("Non-English Vocals", "Nonvocal"))), alpha=0.2) +
  theme_classic()+
  labs(x= "Time (s)", y="Scaled ROI Activity", color="stimulus type", fill="stimulus type")+
  ggtitle("Right pMTG Cluster") +
  theme(plot.title = element_text(face="bold", size = 18, hjust=0.5), axis.text=element_text(size=15), axis.title=element_text(size=15)) +
  scale_color_manual(values = c("#009E73", "#D55E00"))+
  scale_fill_manual(values = c("#009E73", "#D55E00"))

ggplot(timeseries_languageplot, aes(x=round(seconds), y=pMTGL_univariatecluster_scaled)) + 
  annotate(xmin = 6, xmax = 8, ymin = -Inf, ymax = Inf, geom = 'rect', alpha = 0.3, fill="#F0E442")+
  geom_smooth(aes(color=factor(language, labels = c("Non-English Vocals", "Nonvocal")), fill=factor(language, labels = c("Non-English Vocals", "Nonvocal"))), alpha=0.2) +
  theme_classic()+
  labs(x= "Time (s)", y="Scaled ROI Activity", color="stimulus type", fill="stimulus type")+
  ggtitle("Left pMTG Cluster") +
  theme(plot.title = element_text(face="bold", size = 18, hjust=0.5), axis.text=element_text(size=15), axis.title=element_text(size=15)) +
  scale_color_manual(values = c("#009E73", "#D55E00"))+
  scale_fill_manual(values = c("#009E73", "#D55E00"))
```

#english vs non-vocal comparison
```{r}
timeseries_language <-
  MIR_timeseries%>%
  subset(Stim == 10 | Stim == 11 | Stim == 12 | Stim == 13  | Stim == 9 | Stim == 7 | Stim == 14 | Stim == 17 )

timeseries_language$language <- ifelse(timeseries_language$Stim == 10 | timeseries_language$Stim == 11 | timeseries_language$Stim == 12 | timeseries_language$Stim == 13, "English", "Non-Vocal")

test<-lmer(pMTGL_univariatecluster_scaled ~ language + scale(RMS_energy) + scale(event_density) + (scale(RMS_energy) + scale(event_density) + language|SUBID), data=timeseries_language,control=lmerControl(optimizer="bobyqa")) #random intercepts
summary(test)

test<-lmer(pMTGR_univariatecluster_scaled ~ language + scale(RMS_energy) + scale(event_density) + (language + scale(RMS_energy) + scale(event_density)|SUBID), data=timeseries_language, control=lmerControl(optimizer="bobyqa")) #random intercepts
summary(test)
```